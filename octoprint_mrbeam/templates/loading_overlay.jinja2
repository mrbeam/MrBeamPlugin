
<div id="loading_overlay">
    <style>

        #loading_overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10000;
            display: block;
            background-color: #ffffff;
        }

        .loading_overlay_background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .loading_overlay_text{
            margin:0;
            font-family:RobotoFont, Roboto,"Helvetica Neue",Helvetica,Arial,sans-serif;
            font-size:14px;
            line-height:20px;
            cursor: default;
        }

        .loading_overlay_red {
            color: #e25303;
        }
        .loading_overlay_grey {
            color: #999;
        }

        .loading_overlay_wrapper {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
        }

        .loading_overlay_wrapper .loading_overlay_outer {
            display: table;
            width: 100%;
            height: 100%;
        }

        .loading_overlay_wrapper .loading_overlay_outer .loading_overlay_inner {
            display: table-cell;
            padding-top: 40vh;
        }

        .loading_overlay_wrapper .loading_overlay_outer .loading_overlay_inner .loading_overlay_content {
            text-align: center;
        }

        .loading_overlay_pulsate3 {
			animation: pulsate 1s ease-out;
			animation-iteration-count: infinite;
            opacity: 0.1;
        }

		body.run_loading_overlay_animation .loading_overlay_pulsate3 {
            animation:none;
            opacity: 1.0;
        }

        .loading_overlay_footer {
            position: fixed;
            bottom: 5px;
            right: 20px
        }

        .loading_overlay_footer_text {
            margin: 0 0 0 30px;
            float: right;
            color: lightgrey;
            font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
            font-size: 10px;
            cursor: default;
        }

        @keyframes pulsate {
            0% { opacity: 0.5; }
            50% { opacity: 1.0; }
            100% { opacity: 0.5; }
        }

		#face {
			transform: translateX(127px);
			animation-iteration-count: 1;
			animation-fill-mode: forwards;
			animation-timing-function: ease-out;
		}

		body.run_loading_overlay_animation #face {
            animation-name: face_left;
        }

		@keyframes face_left {
			0% { transform: translateX(127px) }
			100% { transform: translateX(0px) }
		}

		#sig_mr, #sig_be, #sig_am, #sig_small_star, #sig_big_star {
			stroke-dasharray: 250;
			stroke-dashoffset: 250;
			animation-iteration-count: 1;
			animation-fill-mode: forwards;
			animation-timing-function: linear;
			fill: none;
			stroke: #383e42;
			stroke-width: 2.5734477;
			stroke-linecap: round;
			stroke-linejoin: round;
			stroke-miterlimit: 4;
			stroke-opacity: 1;
		}

		body.run_loading_overlay_animation #sig_mr, body.run_loading_overlay_animation #sig_be, body.run_loading_overlay_animation #sig_am, body.run_loading_overlay_animation #sig_small_star, body.run_loading_overlay_animation #sig_big_star {
			animation-name: write_path;
		}

		#face { animation-duration: 0.5s; animation-delay: 0s;  }
		#sig_mr { animation-duration: 0.5s; animation-delay: 0.5s;  }
		#sig_be { animation-duration: 0.6s; animation-delay: 1.0s;  }
		#sig_am { animation-duration: 0.7s; animation-delay: 1.6s;  }
		#sig_big_star { animation-duration: 0.5s; animation-delay: 2.1s;  }
		#sig_small_star { animation-duration: 0.5s; animation-delay: 2.5s;  }

		@keyframes write_path {
			0% { stroke-dashoffset: 250; }
			100% { stroke-dashoffset: 75; }
		}

		#loading_icons {
			color: #cbcbcb;
			margin: 1em;
            cursor: default;
		}
		#loading_icons .icon {
			margin: 0.3em;
            font-size: 17px;
			display: inline-block;
            cursor: default;
		}

		body.loading_step1 #loading_icons .icon:nth-child(1),
		body.loading_step2 #loading_icons .icon:nth-child(2),
		body.loading_step3 #loading_icons .icon:nth-child(3),
		body.loading_step4 #loading_icons .icon:nth-child(4),
		body.loading_step5 #loading_icons .icon:nth-child(5),
		body.loading_step6 #loading_icons .icon:nth-child(6),
		body.loading_step7 #loading_icons .icon:nth-child(7),
		body.loading_step8 #loading_icons .icon:nth-child(8)
		{ color: #e25303; }

    </style>
    <div class="loading_overlay_background"></div>
    <div class="loading_overlay_wrapper">
        <div class="loading_overlay_outer">
            <div class="loading_overlay_inner">
                <div class="loading_overlay_content">
                    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 1000 150" height="105" width="700">
						<g transform="matrix(3.1003433,0,0,3.1003433,-642.75428,-1043.4841)">
							<g id="face">
								<path id="mustache" style="fill:#383e42;fill-opacity:1"
									  d="m 240.70457,371.80268 c 0.22923,1.31868 3.56716,1.92014 4.9857,3.03758 1.59558,1.25437 3.32507,2.23562 5.73167,2.80833 -0.43275,-0.491 -0.33213,-0.83145 -0.28673,-1.08868 4.29875,0.9177 6.13113,-1.08868 5.84591,-1.14618 -0.5364,0.16871 -0.74597,0.0719 -0.91695,0 0.74521,-0.57347 1.31792,-2.86584 1.08793,-5.27244 -1.03043,2.3491 -2.7516,2.63584 -4.06952,2.17661 -1.31792,-0.45772 -3.55203,-4.87071 -4.64147,-5.95939 0.50538,-0.053 1.11592,0.0772 1.43367,0.22923 -0.51597,-0.9177 -2.06388,-1.20444 -4.46973,-0.85945 0.28522,-0.40097 0.80119,-0.91694 2.06162,-1.26117 -4.35474,-0.23 -6.13114,3.15181 -7.16232,5.21494 h -0.12105 c -1.0327,-2.06313 -2.80834,-5.44418 -7.16383,-5.21494 1.26042,0.34423 1.77639,0.8602 2.06313,1.26117 -2.40736,-0.34499 -3.95604,-0.0583 -4.46974,0.85945 0.31624,-0.15207 0.9283,-0.28219 1.43216,-0.22923 -1.08868,1.08868 -3.32355,5.50092 -4.64147,5.95939 -1.31792,0.45923 -3.03833,0.17325 -4.06951,-2.17661 -0.22924,2.4066 0.34423,4.69897 1.08868,5.27244 -0.17098,0.0719 -0.3813,0.16871 -0.9177,0 -0.28674,0.0567 1.54791,2.06388 5.84591,1.14618 0.0477,0.25799 0.14753,0.59768 -0.28598,1.08868 2.4066,-0.57271 4.13685,-1.55396 5.73091,-2.80833 1.41855,-1.11744 4.69065,-1.68183 4.98571,-3.03758 0.32607,-0.35785 0.64685,-0.30791 0.923,0 z" />
								<path id="glasses" style="fill:#383e42;fill-opacity:1"
									  d="m 18.193359,17.716797 c -0.30716,0 -0.476562,0.234653 -0.476562,0.470703 v 1.972656 c 0,0.15055 0.085,0.43929 0.212891,0.50586 0.35029,0.18158 1.019943,0.531962 1.152343,0.601562 0.18006,0.0938 0.510035,0.615869 0.578125,0.886719 0.0681,0.27085 2.635864,10.438947 2.777344,10.998047 0.16568,0.65745 0.746101,1.189453 1.488281,1.189453 h 13.78125 c 0.85264,0 1.801383,-0.51996 2.226563,-1.287109 0.42594,-0.76941 4.636718,-8.375 4.636718,-8.375 h 1.445313 c 0,0 4.212732,7.606339 4.638672,8.375 0.42594,0.767909 1.371969,1.287109 2.224609,1.287109 h 13.785156 c 0.740671,0 1.322602,-0.532003 1.488282,-1.189453 0.14072,-0.55229 2.123379,-8.412133 2.755859,-10.914063 0.11953,-0.47663 0.479316,-0.909605 0.791016,-1.072265 0.19368,-0.10063 0.598986,-0.311022 0.878906,-0.457032 0.17098,-0.0885 0.294922,-0.27573 0.294922,-0.52539 v -2.041016 c -0.002,-0.19065 -0.188087,-0.425781 -0.529297,-0.425781 H 49.716797 c -0.62491,0 -1.580826,0.476577 -1.878906,0.835937 -0.29884,0.35936 -1.064453,1.388672 -1.064453,1.388672 h -2.958985 c 0,0 -0.766363,-1.029312 -1.064453,-1.388672 -0.29732,-0.36012 -1.253986,-0.835937 -1.878906,-0.835937 z M 51.5625,19.488281 h 15.283203 c 1.10079,7.6e-4 1.857161,0.892539 1.681641,1.980469 l -1.455078,8.970703 c -0.17704,1.08793 -1.222669,1.978516 -2.324219,1.978516 H 54.541016 c -1.1023,0 -2.20769,-0.878815 -2.455078,-1.953125 l -2.078126,-9.023438 c -0.24664,-1.07431 0.452388,-1.953125 1.554688,-1.953125 z m -27.423828,0.002 h 15.283203 c 1.10003,-7.5e-4 1.800134,0.878815 1.552734,1.953125 l -2.078125,9.023438 c -0.2474,1.07431 -1.352768,1.951172 -2.455078,1.951172 H 26.236328 c -1.1023,0 -2.149142,-0.890586 -2.326172,-1.978516 l -1.455078,-8.97075 c -0.17703,-1.08793 0.581294,-1.978516 1.683594,-1.978516 z"
									  transform="translate(195.01437,325.31053)" />
							</g>
							<path id="sig_be"
								d="m 378.89156,353.12649 c -2.88021,6.90055 -5.96469,13.36608 -8.87743,19.35573 0,0 8.65803,-18.28142 25.32269,-23.25351 8.65047,-2.57986 5.98285,1.91863 3.15257,5.65223 -2.48226,3.27438 -10.34742,11.52084 -10.34742,11.52084 5.92232,-0.57347 14.36549,-1.02438 1.05691,7.31666 8.44544,-0.20806 19.94282,-5.64694 23.26637,-9.75807 3.32356,-4.11112 -7.8417,-3.85389 -9.89121,4.00748 -0.87534,3.35533 3.54219,5.32843 8.40609,5.32843 0,0 4.86844,0 6.80901,0"/>
							<path id="sig_am"
								d="m 425.6021,363.95356 c 3.81531,-1.45712 7.35145,-1.44729 7.20771,1.57137 -9.64458,2.64492 -14.92383,7.84095 -9.39492,8.00058 3.9114,0.11273 8.96065,-1.51462 10.81195,-5.23158 -1.97386,9.50386 3.98251,6.65845 17.5294,-6.28472 -2.3892,6.88391 -3.91744,8.86987 -3.72679,10.98671 0.19216,2.11836 13.94787,-11.64869 14.13928,-10.32472 0.19065,1.32322 -1.0032,21.57774 15.23628,1.2574 1.3671,6.98301 4.13912,9.40929 7.47553,9.45392 4.9562,0 38.24467,0 38.24467,0"/>
							<path id="sig_mr"
								d="m 292.43081,373.71768 c 1.57817,-4.94712 15.98754,-28.04024 17.95913,-27.51292 2.24999,0.6007 -4.01278,27.1301 -4.01278,27.1301 0,0 10.2521,-13.9577 13.11793,-18.92601 2.66913,-4.58624 -2.84843,10.66593 -0.88971,17.77907 0.6408,2.32868 3.03455,1.65913 4.87222,0.53867 3.2479,-1.98066 7.356,-9.65744 7.356,-9.65744 1.86188,1.6092 5.8391,0.74294 5.8391,0.74294 -2.86584,7.42787 -1.62811,9.48192 1.18855,9.48192 2.37634,0 16.21905,0 16.21905,0"/>
							<path id="sig_big_star"
								d="M 519.15859,383.26769 508.00393,363.6116 m 11.29916,0.0832 -11.44594,19.48889" />
							<path id="sig_small_star"
								d="m 520.79578,377.67674 -14.43055,-8.47495 m 7.27731,-4.13004 -0.12408,16.73503 m 7.33936,-12.4968 -14.55463,8.26008" />
						</g>
					</svg>

                    <p id="loading_overlay_message" class="loading_overlay_text loading_overlay_red loading_overlay_pulsate3" data-bind="text: display_state">{{ _('beamOS is starting...') }}</p>
					<div id="loading_icons">
                        <span class="icon">•</span>
                        <span class="icon">•</span>
                        <span class="icon">•</span>
                        <span class="icon">•</span>
                        <span class="icon">•</span>
                        <span class="icon">•</span>
                        <span class="icon">•</span>
                        <span class="icon">•</span>
                    </div>
                    <div id="loading_overlay_error" style="display: none">
                        <p id="loading_overlay_error_generic_mac" class="loading_overlay_text loading_overlay_red">
                            {{ _('Not loading?<br />Try a full reload by pressing <strong>command + shift + r</strong>') }}
                        </p>
                        <p id="loading_overlay_error_generic_pc" class="loading_overlay_text loading_overlay_red">
                            {{ _('Not loading?<br />Try a full reload by pressing <strong>Ctrl + SHIFT + R</strong>') }}
                        </p>
                        <p id="loading_overlay_error_generic_unspecified" class="loading_overlay_text loading_overlay_red">
                            {{ _('Not loading?<br />Try to reload the page.') }}
                        </p>
                        <div id="loading_overlay_error_specific" class="loading_overlay_text loading_overlay_grey">
                            <p style="color: #e25303; display: inherit">{{ _('Something went wrong') }}:</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- The Text -->
        <div id="loading_overlay_footer" class="loading_overlay_footer">
            <div class="loading_overlay_footer_text">Mr Beam Plugin: v{{ mrBeamPluginVersionNumber }}</div>
            <div class="loading_overlay_footer_text">{{ _('Serial') }}: {{ serial }}</div>
            <div class="loading_overlay_footer_text">{{ _('Mr Beam Name') }}: {{ hostname }}</div>
            <div class="loading_overlay_footer_text">© 2020 Mr Beam Lasers GmbH</div>
        </div>
    </div>

    <script lang="javascript" type="text/javascript">
        /**
         * In case the system can not fully load (because of an error)
         * We show some message to the user.
         * This code needs to work without jQuery or knockout.js, since these are not loaded yet.
         */
        let _mrb_loading_overlay_step = 0
        let _mrb_loading_overlay_step_ts = 0
        function _mrb_loading_overlay_blocked_check(){
            let my_step = 0
            let timeout = 15000
            if (document.body.classList.contains('loading_step1')) {my_step = 1}
            if (document.body.classList.contains('loading_step2')) {my_step = 2}
            if (document.body.classList.contains('loading_step3')) {my_step = 3}
            if (document.body.classList.contains('loading_step4')) {my_step = 4}
            if (document.body.classList.contains('loading_step5')) {my_step = 5}
            if (document.body.classList.contains('loading_step6')) {my_step = 6}
            if (document.body.classList.contains('loading_step7')) {my_step = 7}
            if (document.body.classList.contains('loading_step8')) {my_step = 8}

            if (_mrb_loading_overlay_step < my_step) {
                _mrb_loading_overlay_step = my_step
                _mrb_loading_overlay_step_ts = Date.now()
                document.getElementById('loading_overlay_error').style.display = "none"
            } else if (_mrb_loading_overlay_step > 0 && _mrb_loading_overlay_step < 8 && Date.now() - _mrb_loading_overlay_step_ts > timeout) {
                let specific_message = _get_mrb_loading_overlay_generate_error_message()
                if (specific_message) {
                    document.getElementById('loading_overlay_error_specific').insertAdjacentHTML('beforeend', specific_message);
                    document.getElementById('loading_overlay_error_specific').style.display = "inherit"
                    document.getElementById('loading_overlay_error_generic_mac').style.display = "none"
                    document.getElementById('loading_overlay_error_generic_pc').style.display = "none"
                    document.getElementById('loading_overlay_error_generic_unspecified').style.display = "none"
                } else {
                    document.getElementById('loading_overlay_error_specific').style.display = "none"
                    document.getElementById('loading_overlay_error_generic_mac').style.display = "none"
                    document.getElementById('loading_overlay_error_generic_pc').style.display = "none"
                    document.getElementById('loading_overlay_error_generic_unspecified').style.display = "none"
                    if ( /(Mac)/i.test(navigator.platform)) {
                        document.getElementById('loading_overlay_error_generic_mac').style.display = "inherit"
                    } else if ( /(Win|Linux|FreeBSD)/i.test(navigator.platform)){
                        document.getElementById('loading_overlay_error_generic_pc').style.display = "inherit"
                    } else {
                        document.getElementById('loading_overlay_error_generic_unspecified').style.display = "inherit"
                    }
                }
                document.getElementById('loading_overlay_error').style.display = "inherit"

                // do not run again
                return;
            }

            if (_mrb_loading_overlay_step < 8) {
                setTimeout(_mrb_loading_overlay_blocked_check, 2000)
            }
        }
        function _get_mrb_loading_overlay_generate_error_message(){
            let result = ""
            if (console.everything) {
                console.everything.forEach(function (logData) {
                    if (logData.level == 'error' || logData.level == 'warn') {
                        result += logData.msg + "<br />"
                    }
                })
            }
            return result
        }

        _mrb_loading_overlay_blocked_check()

    </script>
</div>
